var executeRules,url="https://webhook.site/90e9d5c9-cd0e-4d44-b172-c9d5a00094eb",reactorPromise=Promise;!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).actionExecutioner={})}(this,function(e){"use strict";var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t,r,o=function(e,n){return fetch&&fetch(e.url,{method:"POST",body:JSON.stringify(n)}),n},i=function(e){return!!e.match(/[[0-9]+]/)},u=function(e){var n=e.match(/\[([0-9]+)]$/);return n&&n[1]},a=function(e,n){var t=n.split("."),r=e;return t.forEach(function(e){if(r)if(i(e)){var n=e.substring(0,e.indexOf("[")),t=u(e);r[n]&&(r=r[n][t])}else r=r[e]}),r||null},c=function(e,n){var t={};return(e.mappings||[]).forEach(function(e){var r=a(n,e.sourceKey);t=function(e,n,t){var r=n.split("."),o=e,a=null,c=null,s=null;if(r.forEach(function(e,n,t){var r={};if(i(e)&&(r=[]),a=o,s=e,-1!==e.indexOf("[")&&(e=e.substring(0,e.indexOf("["))),c=e,o[e]=o[e]||r,Array.isArray(o[e]))if(t[n+1]){var f=u(s);f?(o[e][f]=o[e][f]||{},o=o[e][f]):(o[e].push({}),o=o[e][o[e].length-1])}else o=o[e];else o=o[e]}),Array.isArray(a[c])){var f=u(s);f?a[c][f]=t:a[c].push(t)}else a[c]=t;return e}(t,e.destinationKey,r)}),t},s=function(e){return"number"==typeof e&&isFinite(e)},f=function(e){return"string"==typeof e||e instanceof String},l=function(e,n){return n&&f(e)?e.toLowerCase():e},d=function(e){return s(e)?String(e):e},p=function(e){return f(e)?Number(e):e},h=function(e){return function(n,t,r){return n=d(n),t=d(t),f(n)&&f(t)&&e(n,t,r)}},m=function(e){return function(n,t){return n=p(n),t=p(t),s(n)&&s(t)&&e(n,t)}},g=function(e){return function(n,t,r){return e(l(n,r),l(t,r))}},v={equals:g(function(e,n){return e==n}),doesNotEqual:function(){return!v.equals.apply(null,arguments)},contains:h(g(function(e,n){return-1!==e.indexOf(n)})),doesNotContain:function(){return!v.contains.apply(null,arguments)},startsWith:h(g(function(e,n){return 0===e.indexOf(n)})),doesNotStartWith:function(){return!v.startsWith.apply(null,arguments)},endsWith:h(g(function(e,n){return e.substring(e.length-n.length,e.length)===n})),doesNotEndWith:function(){return!v.endsWith.apply(null,arguments)},matchesRegex:h(function(e,n,t){return new RegExp(n,t?"i":"").test(e)}),doesNotMatchRegex:function(){return!v.matchesRegex.apply(null,arguments)},lessThan:m(function(e,n){return e<n}),lessThanOrEqual:m(function(e,n){return e<=n}),greaterThan:m(function(e,n){return e>n}),greaterThanOrEqual:m(function(e,n){return e>=n}),isTrue:function(e){return!0===e},isTruthy:function(e){return Boolean(e)},isFalse:function(e){return!1===e},isFalsy:function(e){return!e}},y=function(e){return v[e.comparison.operator](e.leftOperand,e.rightOperand,Boolean(e.comparison.caseInsensitive))},b=function(e,n){return a(n,e.path)},w=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r="info",o="debug",i="warn",u="error",a=!1,c=function(e){if(a&&console){var n=Array.prototype.slice.call(arguments,1);n.unshift("ðŸš€"),e!==o||console[e]||(e=r),console[e].apply(console,n)}},s=c.bind(null,"log"),f=c.bind(null,r),l=c.bind(null,o),d=c.bind(null,i),p=c.bind(null,u),h={log:s,info:f,debug:l,warn:d,error:p,get outputEnabled(){return a},set outputEnabled(e){a=e},createPrefixedLogger:function(e){var n="["+e+"]";return{log:s.bind(null,n),info:f.bind(null,n),debug:l.bind(null,n),warn:d.bind(null,n),error:p.bind(null,n)}}},m=function(e){return"string"==typeof e?e.replace(/\s+/g," ").trim():e},g={},v=function(e,n){var t="com.adobe.reactor."+(n||"");return{getItem:function(e){try{return g[t+e]}catch(e){return null}},setItem:function(e,n){try{return g[t+e]=n,!0}catch(e){return!1}}}},y=v(0,"dataElements."),b=v(0,"dataElements."),w="pageview",E="session",x="visitor",_={},P=function(e){var n;try{n=JSON.stringify(e)}catch(e){}return n},j=function(e,n,t){var r;switch(n){case w:return void(_[e]=t);case E:return void((r=P(t))&&y.setItem(e,r));case x:return void((r=P(t))&&b.setItem(e,r))}},O=function(e,n){var t;switch(n){case w:return _.hasOwnProperty(e)?_[e]:null;case E:return null===(t=y.getItem(e))?t:JSON.parse(t);case x:return null===(t=b.getItem(e))?t:JSON.parse(t)}},T=function(e,n,t,r){return"Failed to execute data element module "+e.modulePath+" for data element "+n+". "+t+(r?"\n"+r:"")},N=function(e){return null!=e},S={text:function(e){return e.textContent},cleanText:function(e){return m(e.textContent)}},A=function(e,n,t){for(var r,o=e,i=0,u=n.length;i<u;i++){if(null==o)return;var a=n[i];if(t&&"@"===a.charAt(0)){var c=a.slice(1);o=S[c](o)}else if(o.getAttribute&&(r=a.match(/^getAttribute\((.+)\)$/))){var s=r[1];o=o.getAttribute(s)}else o=o[a]}return o};function R(){}"undefined"!=typeof window?window:void 0!==n||"undefined"!=typeof self&&self;var F=R;function I(e){return Boolean(e&&void 0!==e.length)}function M(){}function C(e){if(!(this instanceof C))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],z(e,this)}function B(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,C._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void k(n.promise,e)}D(n.promise,r)}else(1===e._state?D:k)(n.promise,e._value)})):e._deferreds.push(n)}function D(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof C)return e._state=3,e._value=n,void L(e);if("function"==typeof t)return void z((r=t,o=n,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=n,L(e)}catch(n){k(e,n)}var r,o}function k(e,n){e._state=2,e._value=n,L(e)}function L(e){2===e._state&&0===e._deferreds.length&&C._immediateFn(function(){e._handled||C._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)B(e,e._deferreds[n]);e._deferreds=null}function W(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function z(e,n){var t=!1;try{e(function(e){t||(t=!0,D(n,e))},function(e){t||(t=!0,k(n,e))})}catch(e){if(t)return;t=!0,k(n,e)}}C.prototype.catch=function(e){return this.then(null,e)},C.prototype.then=function(e,n){var t=new this.constructor(M);return B(this,new W(e,n,t)),t},C.prototype.finally=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})},C.all=function(e){return new C(function(n,t){if(!I(e))return t(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);var o=r.length;function i(e,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,function(n){i(e,n)},t)}r[e]=u,0==--o&&n(r)}catch(e){t(e)}}for(var u=0;u<r.length;u++)i(u,r[u])})},C.resolve=function(e){return e&&"object"==typeof e&&e.constructor===C?e:new C(function(n){n(e)})},C.reject=function(e){return new C(function(n,t){t(e)})},C.race=function(e){return new C(function(n,t){if(!I(e))return t(new TypeError("Promise.race accepts an array"));for(var r=0,o=e.length;r<o;r++)C.resolve(e[r]).then(n,t)})},C._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){F(e,0)},C._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},Object.freeze({default:C});var K,V=function(e,n,t,r){var o=[];return(t||[]).forEach(function(t){var i=reactorPromise.resolve(),u=reactorPromise.resolve(r),a=function(e,n){return function(t,r,o){o=o||[];var i=e.getModuleExports(t.modulePath);if("function"!=typeof i)throw new Error("Module did not export a function.");var u=n(t.settings||{},r);return o.unshift(u),i.apply(null,o)}}(e,n),c=function(n){var t=e.getModuleDefinition(n.modulePath);return t&&t.displayName||n.modulePath},s=function(e,n,t){return"Failed to execute "+c(e)+n+(t?"\n"+t:"")},f=function(e){return e||(e=new Error("The extension triggered an error, but no error information was provided.")),e instanceof Error||(e=new Error(String(e))),e};t.conditions&&t.conditions.forEach(function(e){i=i.then(function(){return new reactorPromise(function(n,t){void 0,reactorPromise.resolve(a(e,r,[r])).then(n,t)}).catch(function(n){return n=f(n),function(e,n,t){h.error(s(e,n,t.message,t.stack))}(e,t,n),!1}).then(function(n){if(!function(e,n){return n&&!e.negate||!n&&e.negate}(e,n))return function(e,n){var t=c(e);h.log("Condition "+t+" for rule "+n.name+" not met.")}(e,t),reactorPromise.reject()})})}),t.actions&&(i=i.then(function(){return u}),t.actions.forEach(function(e){i=i.then(function(n){return new reactorPromise(function(t,r){void 0,reactorPromise.resolve(a(e,n,[n])).then(t,r)}).catch(function(n){n=f(n),function(e,n){h.error(s(e,n.message,n.stack))}(e,t)}).then(function(e){return e})})})),i=i.then(function(e){return function(e){h.log('Rule "'+e.name+'" fired.')}(t),e}).catch(function(){}),o.push(i)}),reactorPromise.all(o)},q={},U={},J=(K={},{registerModules:function(e){K=e,Object.keys(K).forEach(function(e){K[e].script=K[e].script()})},getModuleDefinition:function(e){return K[e]},getModuleExports:function(e){return K[e].script}}),$={initialize:function(e,n){var t,r=e.property.settings.undefinedVarsReturnEmpty,o=e.dataElements||{},i=function(e){return o[e]},u=function(e,n,t,r){return function(o,i){var u=n(o);if(!u)return r?"":null;var a,c=u.storageDuration;try{a=e.getModuleExports(u.modulePath)}catch(e){return void h.error(T(u,o,e.message,e.stack))}if("function"==typeof a){var s;try{s=a(t(u.settings,i),i)}catch(e){return void h.error(T(u,o,e.message,e.stack))}return c&&(N(s)?j(o,c,s):s=O(o,c)),N(s)||(s=u.defaultValue||""),"string"==typeof s&&(u.cleanText&&(s=m(s)),u.forceLowerCase&&(s=s.toLowerCase())),s}h.error(T(u,o,"Module did not export a function."))}}(J,i,function(){return t.apply(null,arguments)},r),a=function(e){return function(n){var t=n.split(".")[0];return Boolean(e(n)||"this"===t||"event"===t||"target"===t)}}(i),c=function(e,n){return function(t,r){var o;if(e(t))o=n(t,r);else{var i=t.split("."),u=i.shift();"this"===u?r&&(o=A(r.element,i,!0)):"event"===u?r&&(o=A(r,i)):"target"===u&&r&&(o=A(r.target,i))}return o}}(i,u);return t=function(e,n,t){var r,o,i,u,a=[],c=function(r,o,i){if(!e(o))return r;a.push(o);var u=n(o,i);return a.pop(),null==u&&t?"":u};return r=function(e,n){var t=/^%([^%]+)%$/.exec(e);return t?c(e,t[1],n):e.replace(/%(.+?)%/g,function(e,t){return c(e,t,n)})},o=function(e,n){for(var t={},r=Object.keys(e),o=0;o<r.length;o++){var i=r[o],a=e[i];t[i]=u(a,n)}return t},i=function(e,n){for(var t=[],r=0,o=e.length;r<o;r++)t.push(u(e[r],n));return t},u=function(e,n){return"string"==typeof e?r(e,n):Array.isArray(e)?i(e,n):"object"==typeof e&&null!==e?o(e,n):e},function(e,n){return a.length>10?(h.error("Data element circular reference detected: "+a.join(" -> ")),e):u(e,n)}}(a,c,r),U=function(e,n,t){var r=e.extensions,o=e.buildInfo,i=e.property.settings;return r&&Object.keys(r).forEach(function(e){var u=r[e],a=function(e,n){return function(){return n?e(n):{}}}(n,u.settings),c=h.createPrefixedLogger(u.displayName);q[e]={buildInfo:o,getDataElementValue:t,getExtensionSettings:a,logger:c,propertySettings:i,replaceTokens:n}}),q}(e,t,u),J.registerModules(e.modules),V.bind(null,J,t,e.rules)},getScopedExtensionUtilities:function(e){return U[e]}},Z=$.initialize,G=$.getScopedExtensionUtilities;t.default=$,t.initialize=Z,t.getScopedExtensionUtilities=G}(t={exports:{}},t.exports),t.exports);(r=w)&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")&&r.default;w.initialize,w.getScopedExtensionUtilities;const E={buildInfo:{buildDate:"2019-10-22T17:26:28Z",environment:"development",turbineBuildDate:"2019-06-25T22:25:24Z",turbineVersion:"25.6.0"},modules:{"send-beacon/src/lib/actions/sendBeacon.js":{displayName:"Send Beacon",script:function(){return o}},"core/src/lib/actions/transform.js":{displayName:"Transform Data",script:function(){return c}},"core/src/lib/conditions/valueComparison.js":{displayName:"Value Comparison",script:function(){return y}},"core/src/lib/dataElements/path.js":{displayName:"Path",script:function(){return b}}},dataElements:{de2:{modulePath:"core/src/lib/dataElements/path.js",settings:{path:"events[0].xdm.environment.browserDetails.viewportWidth"}},dev:{modulePath:"core/src/lib/dataElements/path.js",settings:{path:"imsOrg"}}},extensions:{"send-beacon":{displayName:"Send Beacon"},core:{displayName:"Core"}},company:{orgId:"08364A825824E04F0A494115@AdobeOrg"},property:{name:"server",settings:{platform:"server",undefinedVarsReturnEmpty:!1}},rules:[{id:"RL999661363e804f97b7ea2a9f2d7af92c",name:"Forward Beacon with Condition",conditions:[{modulePath:"core/src/lib/conditions/valueComparison.js",settings:{comparison:{operator:"greaterThan"},leftOperand:"%de2%",rightOperand:500}}],actions:[{modulePath:"core/src/lib/actions/transform.js",settings:{mappings:[{sourceKey:"meta.gateway.imsOrgId",destinationKey:"name"}]}},{modulePath:"send-beacon/src/lib/actions/sendBeacon.js",settings:{url:url}}]},{id:"RLc053874a75b84b47a8c7f397d2981991",name:"Forward Beacon 2",actions:[{modulePath:"core/src/lib/actions/transform.js",settings:{mappings:[{sourceKey:"identityMap.ECID[0].id",destinationKey:"name"}]}},{modulePath:"send-beacon/src/lib/actions/sendBeacon.js",settings:{url:url}}]}]};executeRules=w.initialize(E);e.default={},Object.defineProperty(e,"__esModule",{value:!0})});
